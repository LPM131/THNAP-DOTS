<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DOTS</title>
    <style>
/* RESET */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  background: #0d0d0f; /* deep matte black */
  font-family: -apple-system, BlinkMacSystemFont, "SF Pro", sans-serif;
  color: #fff;
  min-height: 100vh;
}

h1 {
  text-align: center;
  margin: 26px 0;
  font-size: 2.4rem;
  font-weight: 500;
  color: #b9b9c4;
  letter-spacing: 2px;
}

/* Main grid container */
.main-grid {
  position: fixed;
  top: 0;
  left: 0;
}

/* Each dot */
.dot {
  width: 100%;
  aspect-ratio: 1; /* makes it perfectly square, scales with container */
  max-width: 100%;
  max-height: 100%;
  background: rgba(255, 255, 255, 0.07);
  border-radius: 50%;
  display: flex;
  justify-content: center;
  align-items: center;
  cursor: pointer;
  transition: transform 0.2s ease, background 0.3s ease;
}

/* Hover = enlarge + brighten */
.dot:hover {
  transform: scale(1.08);
  filter: brightness(1.25);
}

/* ICONS (THIN, NEON, GLOW) */
.dot .icon {
  width: 38px;
  height: 38px;
  stroke-width: 2.4;
  filter: drop-shadow(0 0 10px currentColor);
}

/* ---- MATCHED NEON COLORS (Closest to the reference image) ---- */

/* Row 1 */
.dot[data-id="1"] .icon { color: #4cffb7; stroke: #4cffb7; }   /* Green-teal */
.dot[data-id="2"] .icon { color: #ffd84d; stroke: #ffd84d; }   /* Warm yellow */
.dot[data-id="3"] .icon { color: #ff4d4d; stroke: #ff4d4d; }   /* Red */

/* Row 2 */
.dot[data-id="4"] .icon { color: #58b2ff; stroke: #58b2ff; }   /* Blue */
.dot[data-id="5"] .icon { color: #b28dff; stroke: #b28dff; }   /* Purple */
.dot[data-id="6"] .icon { color: #ff9f40; stroke: #ff9f40; }   /* Orange */

/* Row 3 */
.dot[data-id="7"] .icon { color: #ffaa33; stroke: #ffaa33; }   /* Amber lightning */
.dot[data-id="8"] .icon { color: #cc66ff; stroke: #cc66ff; }   /* Magenta-mask */
.dot[data-id="9"] .icon { color: #42c0ff; stroke: #42c0ff; }   /* Sky-blue cloud */

/* Row 4 */
.dot[data-id="10"] .icon { color: #41ff79; stroke: #41ff79; }  /* Mint play */
.dot[data-id="11"] .icon { color: #ff4d7a; stroke: #ff4d7a; }  /* Pink heart */
.dot[data-id="12"] .icon { color: #379aff; stroke: #379aff; }  /* Light blue pin */

/* Row 5 */
.dot[data-id="13"] .icon { color: #ffae42; stroke: #ffae42; }  /* Yellow bell */
.dot[data-id="14"] .icon { color: #5ab2ff; stroke: #5ab2ff; }  /* Blue star */
.dot[data-id="15"] .icon { color: #ff9533; stroke: #ff9533; }  /* Checkmark orange */

/* Text inside SVG */
.dot svg text {
  fill: currentColor;
  font-weight: 700;
  pointer-events: none;
}



/* MODALS */
.modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: white;
    z-index: 99;
    display: flex;
    flex-direction: column;
}

.hidden {
    display: none !important;
}

/* HEADERS */
.header {
    display: flex;
    justify-content: space-between;
    padding: 20px;
}

/* CHAT */
.thread-area {
    flex: 1;
    position: relative;
    background: #f1f1f1;
    overflow: hidden;
}

.thread-dot {
    position: absolute;
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background: #ffcc80;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    font-weight: bold;
}

.chat-area {
    flex: 1;
    display: flex;
    flex-direction: column;
}

.messages {
    flex: 1;
    overflow-y: auto;
    padding: 10px;
}

.input-section {
    display: flex;
    gap: 10px;
    padding: 10px;
}

/* --- WORDLE --- */
.wordle-area {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 30px;
    padding-bottom: 20px;
    flex: 1;
}

/* --- WORDLE BOARD LAYOUT (Official Style) --- */

#game-container {
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    align-items: center;
    height: calc(100vh - 80px); /* fit inside modal */
    padding: 10px 0;
}

/* Perfect Wordle Board Scaling */
/* The secret:
   Board total height = 6 rows * tile-size + spacing
*/
#game-board {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 6px;
    width: 330px;
    height: 397px;
    margin: 0 auto;
    margin-top: 10px;
}

.tile {
    background: #ffffff;
    border: 2px solid #d3d6da;
    border-radius: 4px;
    position: relative;
    display: flex;
    justify-content: center;
    align-items: center;   /* THIS fixes vertical centering */

    font-size: clamp(16px, 4vw, 28px);
    font-weight: bold;
    text-transform: uppercase;
}

.tile span {
    position: absolute;
}

/* Flip animation */
.tile.flip {
    animation: flip 0.6s ease forwards;
}

@keyframes flip {
    0% { transform: rotateX(0deg); }
    50% { transform: rotateX(90deg); background:#fff; }
    100% { transform: rotateX(0deg); }
}

/* Tile colors (Wordle correct palette) */
.correct { background: #6aaa64 !important; border-color: #6aaa64 !important; color: white !important; }
.present { background: #c9b458 !important; border-color: #c9b458 !important; color: white !important; }
.absent { background: #787c7e !important; border-color: #787c7e !important; color: white !important; }

/* --- KEYBOARD --- */

#keyboard {
    width: 100%;
    max-width: 500px;
    display: flex;
    flex-direction: column;
    gap: 6px;
    padding-bottom: env(safe-area-inset-bottom, 12px);
    height: auto;
    margin-top: auto;
}

.keyboard-row {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(0, 1fr));
    gap: 6px;
}

.key {
    background: #d3d6da;
    padding: 14px 6px;
    border-radius: 6px;
    font-weight: bold;
    text-align: center;
    cursor: pointer;
    user-select: none;
    font-size: clamp(12px, 3vw, 18px);
}

.key.wide {
    grid-column: span 2;
}

.key:active {
    background: #bbb;
}

/* Message */
#game-message {
    margin-top: 10px;
    font-size: 1.2rem;
    font-weight: bold;
    color: #333;
}

/* GEN BUTTONS */
.gen-filter {
    display: flex;
    flex-direction: column;
    gap: 8px;
    margin-bottom: 15px;
    width: 100%;
    align-items: center;
}

.gen-row {
    display: flex;
    justify-content: center;
    gap: 10px;
    flex-wrap: wrap;
}

.gen-row button {
    padding: 8px 14px;
    font-size: 16px;
    border: none;
    border-radius: 8px;
    background: #007aff;
    color: white;
    font-weight: bold;
    cursor: pointer;
}

.gen-row button:active {
    transform: scale(0.95);
    background: #005ec9;
}

/* IMAGE */
#pokemon-silhouette {
    width: 160px;
    height: 160px;
    filter: brightness(0);
    object-fit: contain;
}

/* INPUT */
.input-wrapper {
    position: relative;
    width: 80%;
}

#pokemon-guess {
    width: 100%;
    padding: 12px 16px;
    font-size: 18px;
    border-radius: 8px;
    border: 2px solid #aaa;
}

/* AUTO-SUGGEST LIST */
.pokemon-suggestions {
    position: absolute;
    top: 100%;
    width: 100%;
    background: white;
    border: 1px solid #ccc;
    border-radius: 6px;
    display: none;
    max-height: 180px;
    overflow-y: auto;
    list-style: none;
    padding: 0;
    z-index: 20;
}
.pokemon-suggestions li {
    padding: 8px;
    cursor: pointer;
}
.pokemon-suggestions li:hover {
    background: #f2f2f2;
}

/* BUTTON ROW */
.poke-buttons {
    display: flex;
    gap: 20px;
}
.guess-btn, .hint-btn {
    padding: 14px 20px;
    font-size: 18px;
    border-radius: 8px;
    font-weight: bold;
    background: #007aff;
    color: white;
}
.hint-btn {
    background: #ffb700;
}
/* --------------------------- */
/* POKEMON AREA */
/* --------------------------- */
.pokemon-area {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 20px;
    flex: 1;
    padding: 20px;
}

#pokemon-feedback {
    font-size: 1.2rem;
    font-weight: bold;
    color: #333;
}

/* ================================
   CROSSWORD: FULL UI CSS
   DOT #12 MODULE
   ================================ */

/* --- Modal Layout --- */
#crossword-modal {
    position: fixed;
    inset: 0;
    background: #f7f7f7;
    display: flex;
    flex-direction: column;
    z-index: 999;
    overflow: hidden;
}

#crossword-modal.hidden {
    display: none;
}

#crossword-modal .header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px 18px;
    background: #ffffff;
    border-bottom: 1px solid #ddd;
}

#crossword-modal .header h2 {
    font-size: 22px;
    font-weight: 700;
    margin: 0 auto;
    text-align: center;
    flex-grow: 1;
}

#crossword-modal .header .back {
    border: none;
    background: none;
    font-size: 22px;
    padding: 8px 12px;
    cursor: pointer;
}

/* --- Crossword Layout --- */
.crossword-area {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 14px;
    padding: 10px;
    width: 100%;
    height: calc(100vh - 60px);
    overflow: hidden;
}

/* ===============================
   GRID STYLING
   =============================== */
#crossword-grid {
    display: grid;
    width: 95vw;
    max-width: 460px;
    aspect-ratio: 1 / 1;
    background: white;
    border: 2px solid #000;
    touch-action: manipulation;
}

/* Default: 15√ó15 grid, auto-scaled by JS */
.cross-cell {
    border: 1px solid #aaa;
    background: white;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: min(4vw, 20px);
    font-weight: bold;
    text-transform: uppercase;
    user-select: none;
    position: relative;
}

/* Black squares */
.cross-cell.black {
    background: #000;
    border-color: #000;
}

/* Selected cell */
.cross-cell.selected {
    background: #d8ebff !important;
}

/* Whole word highlight */
.cross-cell.word-highlight:not(.black):not(.selected) {
    background: #eef6ff;
}

/* Small clue numbers (NYT style) */
.cross-cell .clue-number {
    position: absolute;
    top: 2px;
    left: 3px;
    font-size: 0.45em;
    font-weight: 700;
    color: #333;
    pointer-events: none;
}

/* ===============================
   CLUE PANEL
   =============================== */

#crossword-clue {
    width: 95%;
    max-width: 460px;
    background: #ffffff;
    border-radius: 8px;
    border: 1px solid #ccc;
    padding: 12px 14px;
    font-size: 18px;
    min-height: 48px;
    box-shadow: 0px 2px 4px rgba(0,0,0,0.08);
}

#crossword-clue span.clue-direction {
    font-weight: bold;
    color: #0077ff;
}

#crossword-clue span.clue-number {
    font-weight: bold;
    margin-right: 6px;
}

/* ===============================
   ON-SCREEN KEYBOARD
   (touch-friendly)
   =============================== */

#crossword-keyboard {
    width: 100%;
    max-width: 480px;
    display: flex;
    flex-direction: column;
    gap: 6px;
    margin-bottom: 8px;
    margin-top: auto;
}

.ck-row {
    display: flex;
    gap: 6px;
    justify-content: center;
}

.ck-key {
    background: #e9e9e9;
    border-radius: 6px;
    padding: 14px 10px;
    min-width: 9%;
    text-align: center;
    font-size: 18px;
    font-weight: 600;
    user-select: none;
    border: 1px solid #bbb;
    touch-action: manipulation;
}

.ck-key:active {
    background: #d5d5d5;
}

.ck-key.wide {
    min-width: 18%;
}

.ck-key.function {
    background: #cddfff;
    border-color: #8bb4ff;
}

.ck-key.function:active {
    background: #b5ceff;
}

/* ===============================
   RESPONSIVE TUNING
   =============================== */

@media (max-width: 450px) {
    .cross-cell {
        font-size: min(6vw, 24px);
    }
    #crossword-clue {
        font-size: 16px;
    }
    .ck-key {
        padding: 12px 8px;
        font-size: 16px;
    }
}
    </style>
</head>
<body>

    <h1>DOTS</h1>

    <!-- ======================
         MAIN DOT GRID (Matches Reference Image)
         ====================== -->
    <div class="main-grid">

        <!-- Row 1 -->
        <div class="dot" data-id="1" title="Chat">
            <svg class="icon" viewBox="0 0 24 24">
                <rect x="3" y="4" width="18" height="14" rx="3" />
            </svg>
        </div>

        <div class="dot" data-id="2" title="Wordle">
            <svg class="icon" viewBox="0 0 24 24">
                <text x="50%" y="55%" text-anchor="middle" font-size="18">W</text>
            </svg>
        </div>

        <div class="dot" data-id="3" title="Pok√©mon">
            <svg class="icon" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="10"/>
                <circle cx="12" cy="12" r="3"/>
                <line x1="2" y1="12" x2="22" y2="12"/>
            </svg>
        </div>

        <!-- Row 2 -->
        <div class="dot" data-id="4" title="Music">
            <svg class="icon" viewBox="0 0 24 24">
                <path d="M9 18V6l10-2v12" />
                <circle cx="9" cy="18" r="3" />
                <circle cx="19" cy="16" r="3" />
            </svg>
        </div>

        <div class="dot" data-id="5" title="Search">
            <svg class="icon" viewBox="0 0 24 24">
                <circle cx="10" cy="10" r="6"/>
                <line x1="14" y1="14" x2="20" y2="20"/>
            </svg>
        </div>

        <div class="dot" data-id="6" title="Settings">
            <svg class="icon" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="3"/>
                <path d="M19.4 15a1.6 1.6 0 0 1 .3 1.8l.1.1a2 2 0 0 1 0 2.8 2 2 0 0 1-2.8 0l-.1-.1a1.6 1.6 0 0 0-1.8-.3c-.8.3-1.4 1-1.4 1.9V21a2 2 0 0 1-4 0v-.1c0-.9-.6-1.6-1.4-1.9a1.6 1.6 0 0 0-1.8.3l-.1.1a2 2 0 0 1-2.8 0 2 2 0 0 1 0-2.8l.1-.1a1.6 1.6 0 0 0 .3-1.8c-.3-.8-1-1.4-1.9-1.4H3a2 2 0 0 1 0-4h.1c.9 0 1.6-.6 1.9-1.4a1.6 1.6 0 0 0-.3-1.8l-.1-.1a2 2 0 0 1 2.8-2.8l.1.1a1.6 1.6 0 0 0 1.8.3h.1c.8-.3 1.4-1 1.4-1.9V3a2 2 0 0 1 4 0v.1c0 .9.6 1.6 1.4 1.9a1.6 1.6 0 0 0 1.8-.3l.1-.1a2 2 0 0 1 2.8 2.8l-.1.1a1.6 1.6 0 0 0-.3 1.8c.3.8 1 1.4 1.9 1.4H21a2 2 0 0 1 0 4h-.1c-.9 0-1.6.6-1.9 1.4z"/>
            </svg>
        </div>

        <!-- Row 3 -->
        <div class="dot" data-id="7" title="Utilities">
            <svg class="icon" viewBox="0 0 24 24">
                <path d="M12 2v10l4 2" />
            </svg>
        </div>

        <div class="dot" data-id="8" title="Mask">
            <svg class="icon" viewBox="0 0 24 24">
                <circle cx="8" cy="12" r="3"/>
                <circle cx="16" cy="12" r="3"/>
                <path d="M5 12c0 6 14 6 14 0"/>
            </svg>
        </div>

        <div class="dot" data-id="9" title="Cloud">
            <svg class="icon" viewBox="0 0 24 24">
                <path d="M5 16a4 4 0 0 1 0-8 6 6 0 0 1 12 1 4 4 0 0 1 0 7H5z" />
            </svg>
        </div>

        <!-- Row 4 -->
        <div class="dot" data-id="10" title="Play">
            <svg class="icon" viewBox="0 0 24 24">
                <polygon points="8,5 19,12 8,19" />
            </svg>
        </div>

        <div class="dot" data-id="11" title="Heart">
            <svg class="icon" viewBox="0 0 24 24">
                <path d="M12 21s-7-4.3-7-10a4 4 0 0 1 8 0 4 4 0 0 1 8 0c0 5.7-7 10-7 10z" />
            </svg>
        </div>

        <div class="dot" data-id="12" title="Location">
            <svg class="icon" viewBox="0 0 24 24">
                <path d="M12 22s7-8 7-13a7 7 0 0 0-14 0c0 5 7 13 7 13z" />
                <circle cx="12" cy="9" r="2.5"/>
            </svg>
        </div>

        <!-- Row 5 -->
        <div class="dot" data-id="13" title="Bell">
            <svg class="icon" viewBox="0 0 24 24">
                <path d="M12 22a2 2 0 0 0 2-2H10a2 2 0 0 0 2 2zm6-6V11a6 6 0 1 0-12 0v5l-2 2v1h16v-1l-2-2z"/>
            </svg>
        </div>

        <div class="dot" data-id="14" title="Star">
            <svg class="icon" viewBox="0 0 24 24">
                <polygon points="12 3 15 9 22 9 17 13 19 20 12 16 5 20 7 13 2 9 9 9" />
            </svg>
        </div>

        <div class="dot" data-id="15" title="Checklist">
            <svg class="icon" viewBox="0 0 24 24">
                <polyline points="4 12 9 17 20 6"/>
            </svg>
        </div>

    </div>

    <!-- CHAT MODAL -->
    <div id="chat-modal" class="modal hidden">
        <div class="header">
            <button class="back" onclick="backToMain()">‚¨Ö Back</button>
            <h2>Chats</h2>
        </div>

        <div id="thread-area" class="thread-area"></div>

        <div id="chat-area" class="chat-area hidden">
            <div id="messages" class="messages"></div>

            <div class="input-section">
                <input id="chat-input" type="text" placeholder="Type...">
                <button onclick="sendMessage()">Send</button>
            </div>
        </div>
    </div>

    <!-- WORDLE MODAL -->
    <div id="wordle-modal" class="modal hidden">
        <div class="header">
            <button class="back" onclick="backToMain()">‚¨Ö Back</button>
            <h2>WORD OF THE DAY</h2>
        </div>

        <div id="wordle-area" class="wordle-area">
            <div id="game-board"></div>
            <div id="keyboard"></div>

            <div id="game-message" class="game-message"></div>
        </div>
    </div>

    <!-- POKEMON MODAL -->
    <div id="pokemon-modal" class="modal hidden">
        <div class="header">
            <button class="back" onclick="backToMain()">‚¨Ö Back</button>
            <h2>Guess That Pok√©mon</h2>
        </div>

        <div id="pokemon-area" class="pokemon-area">

            <!-- GENERATION FILTER -->
            <div id="gen-filter" class="gen-filter">
                <div class="gen-row">
                    <button onclick="setGeneration(1)">Gen 1</button>
                    <button onclick="setGeneration(2)">Gen 2</button>
                    <button onclick="setGeneration(3)">Gen 3</button>
                    <button onclick="setGeneration(4)">Gen 4</button>
                    <button onclick="setGeneration(5)">Gen 5</button>
                </div>
                <div class="gen-row">
                    <button onclick="setGeneration(6)">Gen 6</button>
                    <button onclick="setGeneration(7)">Gen 7</button>
                    <button onclick="setGeneration(8)">Gen 8</button>
                    <button onclick="setGeneration(9)">Gen 9</button>
                    <button onclick="setGeneration('all')">All</button>
                </div>
            </div>

            <!-- SILHOUETTE -->
            <img id="pokemon-silhouette" src="" alt="Pokemon silhouette">

            <!-- INPUT + AUTOCOMPLETE -->
            <div class="input-wrapper">
                <input id="pokemon-guess" type="text" placeholder="Start typing..." autocomplete="off">
                <ul id="pokemon-suggestions" class="pokemon-suggestions"></ul>
            </div>

            <!-- GUESS + HINT BUTTONS -->
            <div class="poke-buttons">
                <button onclick="guessPokemon()" class="guess-btn">Guess</button>
                <button onclick="giveHint()" class="hint-btn">Hint</button>
            </div>

            <!-- FEEDBACK -->
            <p id="pokemon-feedback"></p>
        </div>
    </div>

    <!-- =============================
         DOT #12 ‚Äî CROSSWORD MODAL
         ============================= -->
    <div id="crossword-modal" class="hidden">
        <div class="header">
            <button class="back" onclick="backToMain()">‚Üê</button>
            <h2>Crossword Puzzle</h2>
        </div>

        <div class="crossword-area">

            <!-- Clue display -->
            <div id="crossword-clue">
                <span class="clue-direction">Across</span>
                <span class="clue-number">1.</span>
                <span class="clue-text">Loading‚Ä¶</span>
            </div>

            <!-- Crossword Grid -->
            <div id="crossword-grid"></div>

            <!-- On-Screen Keyboard -->
            <div id="crossword-keyboard">
                <div class="ck-row">
                    <div class="ck-key">Q</div><div class="ck-key">W</div><div class="ck-key">E</div>
                    <div class="ck-key">R</div><div class="ck-key">T</div><div class="ck-key">Y</div>
                    <div class="ck-key">U</div><div class="ck-key">I</div><div class="ck-key">O</div>
                    <div class="ck-key">P</div>
                </div>
                <div class="ck-row">
                    <div class="ck-key">A</div><div class="ck-key">S</div><div class="ck-key">D</div>
                    <div class="ck-key">F</div><div class="ck-key">G</div><div class="ck-key">H</div>
                    <div class="ck-key">J</div><div class="ck-key">K</div><div class="ck-key">L</div>
                </div>
                <div class="ck-row">
                    <div class="ck-key wide function" data-key="BACK">‚å´</div>
                    <div class="ck-key">Z</div><div class="ck-key">X</div><div class="ck-key">C</div>
                    <div class="ck-key">V</div><div class="ck-key">B</div><div class="ck-key">N</div>
                    <div class="ck-key">M</div>
                    <div class="ck-key wide function" data-key="NEXT">Next</div>
                </div>
            </div>
        </div>
    </div>

    <script>
// ===============================
// DOT ‚Üí MODAL mapping
// ===============================
const modalMap = {
    1: "chat-modal",
    2: "wordle-modal",
    3: "pokemon-modal",
    12: "crossword-modal"
    // others can be mapped later when features are added
};

// Close all modals
function hideAllModals() {
    document.querySelectorAll(".modal").forEach(m => m.classList.add("hidden"));
}

// Return to main grid
function backToMain() {
    hideAllModals();
}

const grid = document.querySelector('.main-grid');
const dots = document.querySelectorAll('.dot');

function layoutDots() {
  const totalDots = dots.length;
  const w = window.innerWidth;
  const h = window.innerHeight;

  let cols = Math.ceil(Math.sqrt(totalDots * (w / h)));
  let rows = Math.ceil(totalDots / cols);

  grid.style.display = 'grid';
  grid.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;
  grid.style.gridTemplateRows = `repeat(${rows}, 1fr)`;
  grid.style.width = '100vw';
  grid.style.height = '100vh';
  grid.style.justifyItems = 'center';
  grid.style.alignItems = 'center';
  grid.style.gap = '6px';

  const dotSize = Math.min(
    (w - (cols - 1) * 6) / cols,
    (h - (rows - 1) * 6) / rows
  );

  dots.forEach(dot => {
    dot.style.width = `${dotSize}px`;
    dot.style.height = `${dotSize}px`;
  });
}

// Initial layout
layoutDots();

// Re-layout on resize
window.addEventListener('resize', layoutDots);

// Add click listeners to all dots
document.querySelectorAll(".dot").forEach(dot => {
    dot.addEventListener("click", () => {
        const id = dot.dataset.id;
        const modalId = modalMap[id];

        hideAllModals();

        if (modalId) {
            document.getElementById(modalId).classList.remove("hidden");
        }
    });
});


// ===============================
// CHAT APP
// ===============================
function sendMessage() {
    const input = document.getElementById("chat-input");
    const text = input.value.trim();

    if (!text) return;

    const msg = document.createElement("div");
    msg.textContent = "You: " + text;
    document.getElementById("messages").appendChild(msg);

    input.value = "";
}


// ===============================
// CHAT MODULE (ORIGINAL)
// ===============================
const threadNames = ["Bot", "Friend 1", "Friend 2"];
let threadsData = {
    "Bot": { x: 40, y: 40 },
    "Friend 1": { x: 160, y: 200 },
    "Friend 2": { x: 100, y: 350 }
};
let velocities = {};

function openChat() {
    document.getElementById("chat-modal").classList.remove("hidden");
    renderThreadDots();
    initPhysics();
}

function renderThreadDots() {
    const threadArea = document.getElementById("thread-area");
    threadArea.innerHTML = "";

    threadNames.forEach(name => {
        const dot = document.createElement("div");
        dot.classList.add("thread-dot");
        dot.textContent = name[0];
        dot.style.left = threadsData[name].x + "px";
        dot.style.top = threadsData[name].y + "px";

        dot.addEventListener("click", () => openThread(name));

        threadArea.appendChild(dot);
    });
}

function openThread(name) {
    threadArea.classList.add("hidden");
    chatArea.classList.remove("hidden");
    messages.innerHTML = `<p>Chat with ${name}</p>`;
}

// FLOATING DOT PHYSICS
function initPhysics() {
    threadNames.forEach(name => {
        velocities[name] = {
            vx: (Math.random() * 2 + 1) * (Math.random() < 0.5 ? -1 : 1),
            vy: (Math.random() * 2 + 1) * (Math.random() < 0.5 ? -1 : 1)
        };
    });

    requestAnimationFrame(updateDots);
}

function updateDots() {
    const dots = document.querySelectorAll(".thread-dot");
    const bounds = threadArea.getBoundingClientRect();

    dots.forEach(dot => {
        const name = threadNames[[...dots].indexOf(dot)];
        const pos = threadsData[name];
        const vel = velocities[name];

        pos.x += vel.vx;
        pos.y += vel.vy;

        if (pos.x <= 0 || pos.x >= bounds.width - 60) vel.vx *= -1;
        if (pos.y <= 0 || pos.y >= bounds.height - 60) vel.vy *= -1;

        dot.style.left = pos.x + "px";
        dot.style.top = pos.y + "px";
    });

    requestAnimationFrame(updateDots);
}

/* --------------------------- */
/* POKEMON GAME MODULE */
/* ----------------------------- */
let pokemonNames = [];
let fullPokemonData = [];
let filteredList = [];
let currentPokemonName = "";
let currentPokemonSprite = "";

const GEN_RANGES = {
    "Gen 1": [1,151], "Gen 2": [152,251], "Gen 3": [252,386],
    "Gen 4": [387,493], "Gen 5": [494,649], "Gen 6": [650,721],
    "Gen 7": [722,809], "Gen 8": [810,898], "Gen 9": [899,1025]
};

async function loadAllPokemonNames() {
    if (pokemonNames.length > 0) return;

    const res = await fetch('https://pokeapi.co/api/v2/pokemon?limit=1025');
    const data = await res.json();

    pokemonNames = data.results.map(p => p.name);
    fullPokemonData = data.results;
}

function openPokemon() {
    document.getElementById("pokemon-modal").classList.remove("hidden");

    loadAllPokemonNames().then(() => {
        document.querySelector('.gen-row button:first-child').classList.add('active');
        loadPokemon();
    });
}

function setGeneration(gen) {
    document.querySelectorAll('.gen-row button').forEach(btn => btn.classList.remove('active'));

    if (gen === 'all') {
        filteredList = fullPokemonData;
        document.querySelector('.gen-row:nth-child(2) button:last-child').classList.add('active');
    } else {
        const start = GEN_RANGES[`Gen ${gen}`][0] - 1;
        const end = GEN_RANGES[`Gen ${gen}`][1];
        filteredList = fullPokemonData.slice(start, end);

        const row = gen <= 5 ? 1 : 2;
        const index = gen <= 5 ? gen - 1 : gen - 6;
        document.querySelector(`.gen-row:nth-child(${row}) button:nth-child(${index + 1})`).classList.add('active');
    }
    loadPokemon();
}

async function loadPokemon() {
    const pool = filteredList.length ? filteredList : fullPokemonData;
    const choice = pool[Math.floor(Math.random() * pool.length)];
    const res = await fetch(choice.url);
    const data = await res.json();

    currentPokemonName = data.name;
    currentPokemonSprite = data.sprites.front_default;

    const img = document.getElementById("pokemon-silhouette");
    img.src = currentPokemonSprite;
    img.style.filter = "brightness(0)";

    document.getElementById("pokemon-feedback").textContent = "";
    document.getElementById("pokemon-guess").value = "";
    document.getElementById("pokemon-suggestions").style.display = "none";
}

function guessPokemon() {
    const guess = document.getElementById("pokemon-guess").value.trim().toLowerCase();
    if (!guess) return;

    const feedback = document.getElementById("pokemon-feedback");

    if (guess === currentPokemonName) {
        feedback.textContent = "üéâ Correct!";
        document.getElementById("pokemon-silhouette").style.filter = "none";
        setTimeout(loadPokemon, 1500);
    } else {
        feedback.textContent = "‚ùå Wrong. Try again!";
    }
}

function giveHint() {
    const feedback = document.getElementById("pokemon-feedback");
    feedback.textContent = `Hint: Starts with "${currentPokemonName[0].toUpperCase()}"`;
}

function spellingAssist() {
    const q = document.getElementById("pokemon-guess").value.toLowerCase();
    const list = document.getElementById("pokemon-suggestions");

    if (!q) { list.style.display = "none"; return; }

    const matches = pokemonNames
        .filter(n => n.startsWith(q))
        .slice(0, 12);

    list.innerHTML = "";
    matches.forEach(name => {
        const li = document.createElement("li");
        li.textContent = name.charAt(0).toUpperCase() + name.slice(1);
        li.onclick = () => {
            document.getElementById("pokemon-guess").value = li.textContent;
            list.style.display = "none";
        };
        list.appendChild(li);
    });

    list.style.display = matches.length ? "block" : "none";
}

document.getElementById("pokemon-guess").addEventListener("input", spellingAssist);

/* ------------------------------ */
/* WORDLE MODULE */
/* ------------------------------ */
const WORD_LIST = ["APPLE","BANJO","CRANE","DANCE","ELITE","FLAME","GRAPE"];

function getWordOfTheDay() {
    const start = new Date("2025-01-01");
    const today = new Date();
    const diff = Math.floor((today - start) / (1000 * 60 * 60 * 24));
    return WORD_LIST[diff % WORD_LIST.length];
}

let WORD = getWordOfTheDay();
let guesses = [];
let currentGuess = "";

const boardEl = document.getElementById("game-board");
const keyboardEl = document.getElementById("keyboard");
const messageEl = document.getElementById("game-message");

function initBoard() {
    boardEl.innerHTML = "";
    for (let i = 0; i < 30; i++) {
        const tile = document.createElement("div");
        tile.classList.add("tile");
        const span = document.createElement("span");
        tile.appendChild(span);
        boardEl.appendChild(tile);
    }
}

function initKeyboard() {
    keyboardEl.innerHTML = "";
    const keys = ["QWERTYUIOP", "ASDFGHJKL", "ZXCVBNM"];

    keys.forEach(row => {
        const rowDiv = document.createElement("div");
        rowDiv.classList.add("keyboard-row");

        if (row === "ZXCVBNM") {
            addKey(rowDiv, "ENTER", "wide");
        }

        [...row].forEach(k => addKey(rowDiv, k));

        if (row === "ZXCVBNM") {
            addKey(rowDiv, "‚å´", "wide");
        }

        keyboardEl.appendChild(rowDiv);
    });
}

function addKey(rowDiv, char, wide = "") {
    const key = document.createElement("div");
    key.classList.add("key");
    if (wide) key.classList.add(wide);
    key.textContent = char;
    key.onclick = () => handleKey(char);
    rowDiv.appendChild(key);
}

function handleKey(k) {
    if (k === "‚å´") {
        currentGuess = currentGuess.slice(0, -1);
        updateBoard();
        return;
    }

    if (k === "ENTER") {
        submitGuess();
        return;
    }

    if (currentGuess.length < 5) {
        currentGuess += k;
        updateBoard();
    }
}

function updateBoard() {
    const tiles = [...document.querySelectorAll(".tile span")];

    for (let i = 0; i < 30; i++) {
        let row = Math.floor(i / 5);

        if (row < guesses.length) {
            tiles[i].textContent = guesses[row][i % 5];
        } else if (row === guesses.length) {
            tiles[i].textContent = currentGuess[i % 5] || "";
        } else {
            tiles[i].textContent = "";
        }
    }
}

function submitGuess() {
    if (currentGuess.length < 5) {
        messageEl.textContent = "Not enough letters.";
        return;
    }

    const guess = currentGuess;
    guesses.push(guess);
    currentGuess = "";
    messageEl.textContent = "";

    revealGuess(guess, guesses.length - 1);
}

function revealGuess(guess, row) {
    const tiles = [...document.querySelectorAll(".tile")];
    const rowTiles = tiles.slice(row * 5, row * 5 + 5);

    [...guess].forEach((char, i) => {
        setTimeout(() => {
            rowTiles[i].classList.add("flip");

            if (WORD[i] === char) rowTiles[i].classList.add("correct");
            else if (WORD.includes(char)) rowTiles[i].classList.add("present");
            else rowTiles[i].classList.add("absent");

            rowTiles[i].querySelector("span").textContent = char;

            if (i === 4) checkEndGame(guess);

        }, i * 300);
    });
}

function checkEndGame(guess) {
    if (guess === WORD) {
        messageEl.textContent = "üéâ You got it!";
    } else if (guesses.length === 6) {
        messageEl.textContent = `The word was: ${WORD}`;
    }
}

function initGame() {
    guesses = [];
    currentGuess = "";
    WORD = getWordOfTheDay();
    initBoard();
    initKeyboard();
    updateBoard();
}

function openWordle() {
    document.getElementById("wordle-modal").classList.remove("hidden");
    initGame();
}

/* ======================================================
   CROSSWORD PUZZLE MODULE
   ====================================================== */
const crosswordModal = document.getElementById("crossword-modal");
const crosswordGrid = document.getElementById("crossword-grid");
const crosswordClue = document.getElementById("crossword-clue");

let crosswordSize = 15;
let crosswordCells = [];
let crosswordData = null;
let selectedCell = null;
let selectedDirection = "across";

const DAILY_CROSSWORD = {
    size: 15,
    grid: [
        "CAT..DOG.......",
        "..A..O........E",
        "RAT..GHOST.....",
"....BIRD.......",
"...TREE....FROG",
"......PLANT....",
"....COW........",
"....PIG........",
"....HORSE......",
"SNAKE....BEAR..",
".....MOUSE.....",
"....SHEEP......",
"...GOAT........",
"..DEER.........",
"FOX............"
    ],
    clues: {
        across: { 1: "Furry pet (3)", 4: "Barks (3)", 7: "Ghost sound (5)", 12: "Tree dwelling singer (4)", 14: "Green giant (4)" },
        down: { 1: "Farm animal (3)", 2: "Croaks (4)", 3: "Forest animal (3)" }
    }
};

function openCrossword(){ crosswordModal.classList.remove("hidden"); loadDailyPuzzle(); }
function loadDailyPuzzle(){ crosswordData=DAILY_CROSSWORD; crosswordSize=crosswordData.size; drawGrid(); drawClueNumbers(); selectFirstCell(); setupKeyboard(); }

function drawGrid(){
    crosswordGrid.style.gridTemplateColumns=`repeat(${crosswordSize},1fr)`;
    crosswordGrid.innerHTML="";
    crosswordCells=[];
    for(let r=0;r<crosswordSize;r++){
        for(let c=0;c<crosswordSize;c++){
            const char=crosswordData.grid[r][c];
            const cell=document.createElement("div");
            cell.classList.add("cross-cell");
            cell.dataset.row=r; cell.dataset.col=c;
            if(char===".") cell.classList.add("black");
            cell.addEventListener("click",()=>selectCell(cell));
            crosswordGrid.appendChild(cell);
            crosswordCells.push(cell);
        }
    }
}

function drawClueNumbers(){
    crosswordCells.forEach(cell=>{
        if(cell.classList.contains("black")) return;
        const r=parseInt(cell.dataset.row), c=parseInt(cell.dataset.col);
        const startsAcross=c===0||getCell(r,c-1).classList.contains("black");
        const startsDown=r===0||getCell(r-1,c).classList.contains("black");
        if(startsAcross||startsDown){
            const number=getClueNumber(r,c);
            const numEl=document.createElement("div");
            numEl.classList.add("clue-number"); numEl.textContent=number;
            cell.appendChild(numEl);
        }
    });
}

function getClueNumber(r,c){ return r*crosswordSize+c+1; }
function getCell(r,c){ return crosswordCells[r*crosswordSize+c]; }

function selectCell(cell){
    crosswordCells.forEach(c=>c.classList.remove("selected","word-highlight"));
    cell.classList.add("selected"); selectedCell=cell;
    highlightWord(cell,selectedDirection);
    updateClueDisplay(cell);
}

function highlightWord(cell,direction){
    const r=parseInt(cell.dataset.row), c=parseInt(cell.dataset.col);
    let coords=[];
    if(direction==="across"){
        let cc=c; while(cc>=0&&!getCell(r,cc).classList.contains("black")) cc--; cc++;
        while(cc<crosswordSize&&!getCell(r,cc).classList.contains("black")) coords.push([r,cc++]);
    } else {
        let rr=r; while(rr>=0&&!getCell(rr,c).classList.contains("black")) rr--; rr++;
        while(rr<crosswordSize&&!getCell(rr,c).classList.contains("black")) coords.push([rr++,c]);
    }
    coords.forEach(([rr,cc])=>{
        const cell=getCell(rr,cc);
        if(!cell.classList.contains("selected")) cell.classList.add("word-highlight");
    });
}

function updateClueDisplay(cell){
    const number=cell.querySelector(".clue-number")?.textContent || "?";
    const clueObj=crosswordData.clues[selectedDirection];
    const clueText=clueObj[number] || "‚Äî";
    crosswordClue.innerHTML=`<span class="clue-direction">${selectedDirection.toUpperCase()}</span> <span class="clue-number">${number}.</span> <span class="clue-text">${clueText}</span>`;
}

function selectFirstCell(){ const cell=crosswordCells.find(c=>!c.classList.contains("black")); if(cell) selectCell(cell); }
function setupKeyboard(){
    document.querySelectorAll("#crossword-keyboard .ck-key").forEach(key=>{
        key.onclick=()=>{
            const value=key.dataset.key||key.textContent;
            if(!selectedCell||selectedCell.classList.contains("black")) return;
            if(value==="BACK") return backspaceCell();
            if(value==="NEXT") return moveToNextCell();
            fillCell(value);
        };
    });
}
function fillCell(letter){ selectedCell.textContent=letter; moveToNextCell(); }
function backspaceCell(){ if(selectedCell) selectedCell.textContent=""; }
function moveToNextCell(){
    if(!selectedCell) return;
    const r=parseInt(selectedCell.dataset.row), c=parseInt(selectedCell.dataset.col);
    let nr=r,nc=c;
    if(selectedDirection==="across") nc++; else nr++;
    const next=getCell(nr,nc);
    if(next&&!next.classList.contains("black")) selectCell(next);
}
